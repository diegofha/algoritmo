#include <iostream>
#include <conio.h>
#include <stdio.h>
#include <string.h>
using namespace std;
struct amigos{
	char nombre[30];
	int edad;
	char sexo;
	char estado;
};
void registro(){
	FILE *ptr;
	amigos reg;
	
	
	cout<<"\n introducir nombre:\n";
	do{
	gets(reg.nombre);
	}while(strlen(reg.nombre)==0);
	cout<<"\n edad: \n";
	cin>>reg.edad;
	cout<<"\n sexo f/m \n";
	cin>>reg.sexo;
	cout<<"estado A/E:\n";
	cin>>reg.estado;
	ptr=fopen("misamigos.dat","ab");
	fwrite(&reg,sizeof(reg),1,ptr);
	fclose(ptr);
}
void mostrar(){
	FILE *ptr;
	amigos reg;
	int c=0;
	ptr=fopen("misamigos.dat","rb");
	if(ptr!=NULL){
		cout<<"------------------------------------------------------------------------\n";
			cout<<"----------------------------LISTADO---------------------------------\n";
	       cout<<"nro registro"<<"\t"<<"nombre \t"<<"edad \t"<<"sexo \t"<<"estado";
		fread(&reg,sizeof(reg),1,ptr);
		while(feof(ptr)==false){
			c++;
			if(reg.estado=='A'){
			cout<<"\n"<<c<<"\t \t"<<reg.nombre<<"\t"<<reg.edad<<"\t"<<reg.sexo<<"\t"<<reg.estado;
			}fread(&reg,sizeof(reg),1,ptr);
		}
	}else{
		cout<<"\n el archivo no existe!!! \n";
	}
	fclose(ptr);
}
void promedio(){
	FILE *ptr;
	amigos reg;
	int sf=0,cf=0,sm=0,cm=0;
	ptr=fopen("misamigos.dat","rb");
	if(ptr!=NULL){
		fread(&reg,sizeof(reg),1,ptr);
		while(feof(ptr)==false){
			if(reg.estado=='A'){
			if(reg.sexo=='f'){
				sf=sf + reg.edad;
				cf++;
			}else{
				sm=sm + reg.edad;
				cm++;
			}
		}
			
		fread(&reg,sizeof(reg),1,ptr);
	
	 } fclose(ptr);
		
	if(cf>0){
		cout<<"\n promedio de damas----->"<<sf/cf;}
	if(cm>0){
		cout<<"\n promedio de varones----->"<<sm/cm;}
	if(cm+cf>0){
		cout<<"\n promedio total----->"<<(sf+sm)/(cf+cm);}
	}else{
		cout<<"\n el archivo no existe!!!!";
 }
}
void eliminar(int nro){
	FILE*ptr;
	amigos reg;
	char r;
	ptr=fopen("misamigos.dat","r+b");
	if(ptr!=NULL){
		fseek(ptr,(nro-1)*sizeof(reg),SEEK_SET);
		fread(&reg,sizeof(reg),1,ptr);
        if(reg.estado=='A'){
			cout<<"\n el registro encontrado es:\n";
			cout<<nro<<"\t"<<reg.nombre<<"\t"<<reg.edad<<"\t"<<reg.sexo<<"\t"<<reg.estado;
		}else{
			cout<<"\n el registro fue eliminado:";
		}
	     cout<< "\n desea eliminarlo? s/n";
		 cin>>r;
		 if(r=='s'){
		         	reg.estado='E';
					fseek(ptr,(nro-1)*sizeof(reg),SEEK_SET);
					fwrite(&reg,sizeof(reg),1,ptr);
		 }fclose(ptr);
  }else{cout<<"el archivo no existe!!!!";
}cout<<"\n registro deshabilitado...";
}
void buscar(int nro){
	FILE *ptr;
	amigos reg;
	char r;
	ptr=fopen("misamigos.dat","rb");
	if(ptr!=NULL){
		fseek(ptr,(nro-1)*sizeof(reg),SEEK_SET);
		fread(&reg,sizeof(reg),1,ptr);
		if(feof(ptr)==false){
			if(reg.estado=='A'){
				cout<<"\nel registro es:\n";
				cout<<nro<<"\t"<<reg.nombre<<"\t"<<reg.edad<<"\t"<<reg.estado;
				cout<<"\n desea desabilitarlo? s/n :";
				cin>>r;
				if(r=='s'){
					eliminar(nro);
					
				}
			}else{
				cout<<"\n el registro fue eliminado";
			}
		}else{
			cout<<"\n no existe registro :";
		}
	}else{
		cout<<"\n archivo no existe!!!";
	 }
}

void mostrardeshabilitados(){
	FILE *ptr;
	amigos reg;
	int c=0;
	ptr=fopen("misamigos.dat","rb");
	if(ptr!=NULL){
		cout<<"------------------------------------------------------------------------\n";
			cout<<"----------------------------LISTADO---------------------------------\n";
	       cout<<"nro registro"<<"\t"<<"nombre \t"<<"edad \t"<<"sexo \t"<<"estado";
		fread(&reg,sizeof(reg),1,ptr);
		while(feof(ptr)==false){
			c++;
			if(reg.estado=='E'){
			cout<<"\n"<<c<<"\t \t"<<reg.nombre<<"\t"<<reg.edad<<"\t"<<reg.sexo<<"\t"<<reg.estado;
			}fread(&reg,sizeof(reg),1,ptr);
		}
	}else{
		cout<<"\n el archivo no existe!!! \n";
	}
	fclose(ptr);
}
void habilitar(int nro){
	FILE*ptr;
	amigos reg;
	char r;
	ptr=fopen("misamigos.dat","r+b");
	if(ptr!=NULL){
		fseek(ptr,(nro-1)*sizeof(reg),SEEK_SET);
		fread(&reg,sizeof(reg),1,ptr);
        if(reg.estado=='E'){
			cout<<"\n el registro encontrado es:\n";
			cout<<nro<<"\t"<<reg.nombre<<"\t"<<reg.edad<<"\t"<<reg.sexo<<"\t"<<reg.estado;
		}else{
			cout<<"\n el registro fue eliminado:";
		}
	     cout<< "\n desea habilitar? s/n :";
		 cin>>r;
		 if(r=='s'){
		         	reg.estado='A';
					fseek(ptr,(nro-1)*sizeof(reg),SEEK_SET);
					fwrite(&reg,sizeof(reg),1,ptr);
		 }fclose(ptr);
  }else{cout<<"el archivo no existe!!!!";
}cout<<"\n registro deshabilitado...";
}
//void bool si alguien fue eliminado
//void cant de deshabilitados y habilitados

void menu(){
	int opcion,nro;
	char r;
	do{
	cout<<"\n -----------------------------------------------------\n";
	cout<<"---------------BIENVENIDO----------------------------\n";
	cout<<"-----------------------------------------------------\n";
	cout<<"1.-agregar registro:\n";
	cout<<"2.-ver lista:\n";
	cout<<"3.-ver promedio:\n";
	cout<<"4.-buscar por nro registro \n";
	cout<<"5.-lista de deshabilitados \n";
	cout<<"6.-salir:\n";
	cout<<"elija una opcion \n";
	cin>>opcion;
    switch(opcion){
	case 1:cout<<"\n-------------------------REGISTRO-----------------------------\n";
		   registro();
		
		   break;
	case 2:
		
			mostrar();
		     break;
	case 3:
		    promedio();
		    break;

	case 4:cout<<" \n ingrese el nro de registro a buscar:";
		       cin>>nro;
			   buscar(nro);
		       break;
	case 5:cout<<"\n ______________________________________________________________\n";
			   cout<<"_____________________LISTADO DESHABILITADO____________________\n";
			   cout<<"______________________________________________________________\n";
			   mostrardeshabilitados();
			   cout<<"\n desea habilitar a alguien: s/n ";
			   cin>>r;
			   if(r=='s'){
				   cout<<"\ningrese nro registro....:";
				   cin>>nro;
				 habilitar(nro);
			   }break;

	case 6:
		cout<<"\n saliendo......";
		   break;
	}
	}while(opcion!=6);
}
void main(){
	
	menu();
	
getch();
}
